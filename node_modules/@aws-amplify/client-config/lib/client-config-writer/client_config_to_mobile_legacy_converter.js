/**
 * Converts client config to a different shapes needed by mobile libraries for Gen1 format.
 */
export class ClientConfigMobileConverter {
    packageName;
    packageVersion;
    /**
     * Creates client config converter
     */
    constructor(packageName, packageVersion) {
        this.packageName = packageName;
        this.packageVersion = packageVersion;
    }
    /**
     * Converts client config to a shape consumable by mobile libraries.
     */
    convertToMobileConfig = (clientConfig) => {
        const userAgent = `${this.packageName}/${this.packageVersion}`;
        const mobileConfig = {
            UserAgent: userAgent,
            Version: '1.0',
        };
        if (clientConfig.aws_user_pools_id) {
            const authConfig = {
                plugins: {
                    awsCognitoAuthPlugin: {
                        UserAgent: userAgent,
                        Version: '1.0',
                        CognitoUserPool: {
                            Default: {
                                PoolId: clientConfig.aws_user_pools_id,
                                AppClientId: clientConfig.aws_user_pools_web_client_id,
                                Region: clientConfig.aws_cognito_region,
                            },
                        },
                        CredentialsProvider: {
                            CognitoIdentity: {
                                Default: {
                                    PoolId: clientConfig.aws_cognito_identity_pool_id,
                                    Region: clientConfig.aws_cognito_region,
                                },
                            },
                        },
                        Auth: {
                            Default: {
                                authenticationFlowType: 'USER_SRP_AUTH',
                                mfaConfiguration: clientConfig.aws_cognito_mfa_configuration,
                                mfaTypes: clientConfig.aws_cognito_mfa_types,
                                passwordProtectionSettings: {
                                    passwordPolicyMinLength: clientConfig.aws_cognito_password_protection_settings
                                        ?.passwordPolicyMinLength,
                                    passwordPolicyCharacters: clientConfig.aws_cognito_password_protection_settings
                                        ?.passwordPolicyCharacters ?? [],
                                },
                                signupAttributes: clientConfig.aws_cognito_signup_attributes ?? [],
                                usernameAttributes: clientConfig.aws_cognito_username_attributes ?? [],
                                verificationMechanisms: clientConfig.aws_cognito_verification_mechanisms ?? [],
                            },
                        },
                    },
                },
            };
            mobileConfig.auth = authConfig;
        }
        if (clientConfig.aws_appsync_graphqlEndpoint) {
            const apiConfig = {
                plugins: {
                    awsAPIPlugin: {
                        data: {
                            endpointType: 'GraphQL',
                            endpoint: clientConfig.aws_appsync_graphqlEndpoint,
                            region: clientConfig.aws_appsync_region,
                            authorizationType: clientConfig.aws_appsync_authenticationType,
                            apiKey: clientConfig.aws_appsync_apiKey,
                        },
                    },
                },
            };
            mobileConfig.api = apiConfig;
            if (mobileConfig.auth) {
                let defaultClientDatabasePrefix = undefined;
                if (clientConfig.aws_appsync_authenticationType) {
                    defaultClientDatabasePrefix = `data_${clientConfig.aws_appsync_authenticationType}`;
                }
                mobileConfig.auth.plugins.awsCognitoAuthPlugin.AppSync = {
                    Default: {
                        ApiUrl: clientConfig.aws_appsync_graphqlEndpoint,
                        Region: clientConfig.aws_appsync_region,
                        AuthMode: clientConfig.aws_appsync_authenticationType,
                        ApiKey: clientConfig.aws_appsync_apiKey,
                        ClientDatabasePrefix: defaultClientDatabasePrefix,
                    },
                };
                if (clientConfig.aws_appsync_additionalAuthenticationTypes) {
                    for (const additionalAuthenticationType of clientConfig.aws_appsync_additionalAuthenticationTypes.split(',')) {
                        mobileConfig.auth.plugins.awsCognitoAuthPlugin.AppSync[`data_${additionalAuthenticationType}`] = {
                            ApiUrl: clientConfig.aws_appsync_graphqlEndpoint,
                            Region: clientConfig.aws_appsync_region,
                            AuthMode: clientConfig.aws_appsync_authenticationType,
                            ApiKey: clientConfig.aws_appsync_apiKey,
                            ClientDatabasePrefix: `data_${additionalAuthenticationType}`,
                        };
                    }
                }
            }
        }
        if (clientConfig.geo) {
            const geoConfig = {
                plugins: {
                    awsLocationGeoPlugin: {
                        region: clientConfig.geo.amazon_location_service.region,
                    },
                },
            };
            const maps = clientConfig.geo.amazon_location_service.maps;
            if (maps) {
                geoConfig.plugins.awsLocationGeoPlugin.maps = maps;
            }
            const searchIndices = clientConfig.geo.amazon_location_service.search_indices;
            if (searchIndices) {
                geoConfig.plugins.awsLocationGeoPlugin.searchIndices = searchIndices;
            }
            mobileConfig.geo = geoConfig;
        }
        if (clientConfig.Analytics) {
            mobileConfig.analytics = {
                plugins: {
                    awsPinpointAnalyticsPlugin: {
                        pinpointAnalytics: {
                            region: clientConfig.Analytics.Pinpoint.region,
                            appId: clientConfig.Analytics.Pinpoint.appId,
                        },
                        pinpointTargeting: {
                            region: clientConfig.Analytics.Pinpoint.region,
                        },
                    },
                },
            };
        }
        if (clientConfig.Notifications) {
            mobileConfig.notifications = {
                plugins: {},
            };
            if (clientConfig.Notifications.SMS) {
                mobileConfig.notifications.plugins.awsPinpointSmsNotificationsPlugin =
                    clientConfig.Notifications.SMS.AWSPinpoint;
            }
            if (clientConfig.Notifications.EMAIL) {
                mobileConfig.notifications.plugins.awsPinpointEmailNotificationsPlugin =
                    clientConfig.Notifications.EMAIL.AWSPinpoint;
            }
            if (clientConfig.Notifications.InAppMessaging) {
                mobileConfig.notifications.plugins.awsPinpointInAppMessagingNotificationsPlugin =
                    clientConfig.Notifications.InAppMessaging.AWSPinpoint;
            }
            if (clientConfig.Notifications.Push) {
                mobileConfig.notifications.plugins.awsPinpointPushNotificationsPlugin =
                    clientConfig.Notifications.Push.AWSPinpoint;
            }
        }
        if (clientConfig.aws_user_files_s3_bucket) {
            mobileConfig.storage = {
                plugins: {
                    awsS3StoragePlugin: {
                        bucket: clientConfig.aws_user_files_s3_bucket,
                        region: clientConfig.aws_user_files_s3_bucket_region,
                    },
                },
            };
        }
        return mobileConfig;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50X2NvbmZpZ190b19tb2JpbGVfbGVnYWN5X2NvbnZlcnRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGllbnQtY29uZmlnLXdyaXRlci9jbGllbnRfY29uZmlnX3RvX21vYmlsZV9sZWdhY3lfY29udmVydGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVFBOztHQUVHO0FBQ0gsTUFBTSxPQUFPLDJCQUEyQjtJQUtuQjtJQUNBO0lBTG5COztPQUVHO0lBQ0gsWUFDbUIsV0FBbUIsRUFDbkIsY0FBc0I7UUFEdEIsZ0JBQVcsR0FBWCxXQUFXLENBQVE7UUFDbkIsbUJBQWMsR0FBZCxjQUFjLENBQVE7SUFDdEMsQ0FBQztJQUNKOztPQUVHO0lBQ0gscUJBQXFCLEdBQUcsQ0FDdEIsWUFBZ0MsRUFDWixFQUFFO1FBQ3RCLE1BQU0sU0FBUyxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFL0QsTUFBTSxZQUFZLEdBQXVCO1lBQ3ZDLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLE9BQU8sRUFBRSxLQUFLO1NBQ2YsQ0FBQztRQUNGLElBQUksWUFBWSxDQUFDLGlCQUFpQixFQUFFO1lBQ2xDLE1BQU0sVUFBVSxHQUEyQjtnQkFDekMsT0FBTyxFQUFFO29CQUNQLG9CQUFvQixFQUFFO3dCQUNwQixTQUFTLEVBQUUsU0FBUzt3QkFDcEIsT0FBTyxFQUFFLEtBQUs7d0JBQ2QsZUFBZSxFQUFFOzRCQUNmLE9BQU8sRUFBRTtnQ0FDUCxNQUFNLEVBQUUsWUFBWSxDQUFDLGlCQUFpQjtnQ0FDdEMsV0FBVyxFQUFFLFlBQVksQ0FBQyw0QkFBNEI7Z0NBQ3RELE1BQU0sRUFBRSxZQUFZLENBQUMsa0JBQWtCOzZCQUN4Qzt5QkFDRjt3QkFDRCxtQkFBbUIsRUFBRTs0QkFDbkIsZUFBZSxFQUFFO2dDQUNmLE9BQU8sRUFBRTtvQ0FDUCxNQUFNLEVBQUUsWUFBWSxDQUFDLDRCQUE0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YSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUM7YUFDOUM7WUFDRCxJQUFJLFlBQVksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFO2dCQUNwQyxZQUFZLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxtQ0FBbUM7b0JBQ3BFLFlBQVksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQzthQUNoRDtZQUNELElBQUksWUFBWSxDQUFDLGFBQWEsQ0FBQyxjQUFjLEVBQUU7Z0JBQzdDLFlBQVksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLDRDQUE0QztvQkFDN0UsWUFBWSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDO2FBQ3pEO1lBQ0QsSUFBSSxZQUFZLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRTtnQkFDbkMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsa0NBQWtDO29CQUNuRSxZQUFZLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7YUFDL0M7U0FDRjtRQUVELElBQUksWUFBWSxDQUFDLHdCQUF3QixFQUFFO1lBQ3pDLFlBQVksQ0FBQyxPQUFPLEdBQUc7Z0JBQ3JCLE9BQU8sRUFBRTtvQkFDUCxrQkFBa0IsRUFBRTt3QkFDbEIsTUFBTSxFQUFFLFlBQVksQ0FBQyx3QkFBd0I7d0JBQzdDLE1BQU0sRUFBRSxZQUFZLENBQUMsK0JBQStCO3FCQUNyRDtpQkFDRjthQUNGLENBQUM7U0FDSDtRQUVELE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUMsQ0FBQztDQUNIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xpZW50Q29uZmlnTGVnYWN5IH0gZnJvbSAnLi4vY2xpZW50LWNvbmZpZy10eXBlcy9jbGllbnRfY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIENsaWVudENvbmZpZ01vYmlsZSxcbiAgQ2xpZW50Q29uZmlnTW9iaWxlQXBpLFxuICBDbGllbnRDb25maWdNb2JpbGVBdXRoLFxuICBDbGllbnRDb25maWdNb2JpbGVHZW8sXG59IGZyb20gJy4uL2NsaWVudC1jb25maWctdHlwZXMvbW9iaWxlL2NsaWVudF9jb25maWdfbW9iaWxlX3R5cGVzLmpzJztcblxuLyoqXG4gKiBDb252ZXJ0cyBjbGllbnQgY29uZmlnIHRvIGEgZGlmZmVyZW50IHNoYXBlcyBuZWVkZWQgYnkgbW9iaWxlIGxpYnJhcmllcyBmb3IgR2VuMSBmb3JtYXQuXG4gKi9cbmV4cG9ydCBjbGFzcyBDbGllbnRDb25maWdNb2JpbGVDb252ZXJ0ZXIge1xuICAvKipcbiAgICogQ3JlYXRlcyBjbGllbnQgY29uZmlnIGNvbnZlcnRlclxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYWNrYWdlTmFtZTogc3RyaW5nLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcGFja2FnZVZlcnNpb246IHN0cmluZ1xuICApIHt9XG4gIC8qKlxuICAgKiBDb252ZXJ0cyBjbGllbnQgY29uZmlnIHRvIGEgc2hhcGUgY29uc3VtYWJsZSBieSBtb2JpbGUgbGlicmFyaWVzLlxuICAgKi9cbiAgY29udmVydFRvTW9iaWxlQ29uZmlnID0gKFxuICAgIGNsaWVudENvbmZpZzogQ2xpZW50Q29uZmlnTGVnYWN5XG4gICk6IENsaWVudENvbmZpZ01vYmlsZSA9PiB7XG4gICAgY29uc3QgdXNlckFnZW50ID0gYCR7dGhpcy5wYWNrYWdlTmFtZX0vJHt0aGlzLnBhY2thZ2VWZXJzaW9ufWA7XG5cbiAgICBjb25zdCBtb2JpbGVDb25maWc6IENsaWVudENvbmZpZ01vYmlsZSA9IHtcbiAgICAgIFVzZXJBZ2VudDogdXNlckFnZW50LFxuICAgICAgVmVyc2lvbjogJzEuMCcsXG4gICAgfTtcbiAgICBpZiAoY2xpZW50Q29uZmlnLmF3c191c2VyX3Bvb2xzX2lkKSB7XG4gICAgICBjb25zdCBhdXRoQ29uZmlnOiBDbGllbnRDb25maWdNb2JpbGVBdXRoID0ge1xuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgYXdzQ29nbml0b0F1dGhQbHVnaW46IHtcbiAgICAgICAgICAgIFVzZXJBZ2VudDogdXNlckFnZW50LFxuICAgICAgICAgICAgVmVyc2lvbjogJzEuMCcsXG4gICAgICAgICAgICBDb2duaXRvVXNlclBvb2w6IHtcbiAgICAgICAgICAgICAgRGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIFBvb2xJZDogY2xpZW50Q29uZmlnLmF3c191c2VyX3Bvb2xzX2lkLFxuICAgICAgICAgICAgICAgIEFwcENsaWVudElkOiBjbGllbnRDb25maWcuYXdzX3VzZXJfcG9vbHNfd2ViX2NsaWVudF9pZCxcbiAgICAgICAgICAgICAgICBSZWdpb246IGNsaWVudENvbmZpZy5hd3NfY29nbml0b19yZWdpb24sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgQ3JlZGVudGlhbHNQcm92aWRlcjoge1xuICAgICAgICAgICAgICBDb2duaXRvSWRlbnRpdHk6IHtcbiAgICAgICAgICAgICAgICBEZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgICBQb29sSWQ6IGNsaWVudENvbmZpZy5hd3NfY29nbml0b19pZGVudGl0eV9wb29sX2lkLFxuICAgICAgICAgICAgICAgICAgUmVnaW9uOiBjbGllbnRDb25maWcuYXdzX2NvZ25pdG9fcmVnaW9uLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgQXV0aDoge1xuICAgICAgICAgICAgICBEZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgYXV0aGVudGljYXRpb25GbG93VHlwZTogJ1VTRVJfU1JQX0FVVEgnLFxuICAgICAgICAgICAgICAgIG1mYUNvbmZpZ3VyYXRpb246IGNsaWVudENvbmZpZy5hd3NfY29nbml0b19tZmFfY29uZmlndXJhdGlvbixcbiAgICAgICAgICAgICAgICBtZmFUeXBlczogY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX21mYV90eXBlcyxcbiAgICAgICAgICAgICAgICBwYXNzd29yZFByb3RlY3Rpb25TZXR0aW5nczoge1xuICAgICAgICAgICAgICAgICAgcGFzc3dvcmRQb2xpY3lNaW5MZW5ndGg6XG4gICAgICAgICAgICAgICAgICAgIGNsaWVudENvbmZpZy5hd3NfY29nbml0b19wYXNzd29yZF9wcm90ZWN0aW9uX3NldHRpbmdzXG4gICAgICAgICAgICAgICAgICAgICAgPy5wYXNzd29yZFBvbGljeU1pbkxlbmd0aCxcbiAgICAgICAgICAgICAgICAgIHBhc3N3b3JkUG9saWN5Q2hhcmFjdGVyczpcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX3Bhc3N3b3JkX3Byb3RlY3Rpb25fc2V0dGluZ3NcbiAgICAgICAgICAgICAgICAgICAgICA/LnBhc3N3b3JkUG9saWN5Q2hhcmFjdGVycyA/PyBbXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNpZ251cEF0dHJpYnV0ZXM6XG4gICAgICAgICAgICAgICAgICBjbGllbnRDb25maWcuYXdzX2NvZ25pdG9fc2lnbnVwX2F0dHJpYnV0ZXMgPz8gW10sXG4gICAgICAgICAgICAgICAgdXNlcm5hbWVBdHRyaWJ1dGVzOlxuICAgICAgICAgICAgICAgICAgY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX3VzZXJuYW1lX2F0dHJpYnV0ZXMgPz8gW10sXG4gICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uTWVjaGFuaXNtczpcbiAgICAgICAgICAgICAgICAgIGNsaWVudENvbmZpZy5hd3NfY29nbml0b192ZXJpZmljYXRpb25fbWVjaGFuaXNtcyA/PyBbXSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBtb2JpbGVDb25maWcuYXV0aCA9IGF1dGhDb25maWc7XG4gICAgfVxuXG4gICAgaWYgKGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19ncmFwaHFsRW5kcG9pbnQpIHtcbiAgICAgIGNvbnN0IGFwaUNvbmZpZzogQ2xpZW50Q29uZmlnTW9iaWxlQXBpID0ge1xuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgYXdzQVBJUGx1Z2luOiB7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGVuZHBvaW50VHlwZTogJ0dyYXBoUUwnLFxuICAgICAgICAgICAgICBlbmRwb2ludDogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2dyYXBocWxFbmRwb2ludCxcbiAgICAgICAgICAgICAgcmVnaW9uOiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfcmVnaW9uLFxuICAgICAgICAgICAgICBhdXRob3JpemF0aW9uVHlwZTogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2F1dGhlbnRpY2F0aW9uVHlwZSxcbiAgICAgICAgICAgICAgYXBpS2V5OiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYXBpS2V5LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIG1vYmlsZUNvbmZpZy5hcGkgPSBhcGlDb25maWc7XG5cbiAgICAgIGlmIChtb2JpbGVDb25maWcuYXV0aCkge1xuICAgICAgICBsZXQgZGVmYXVsdENsaWVudERhdGFiYXNlUHJlZml4ID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAoY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2F1dGhlbnRpY2F0aW9uVHlwZSkge1xuICAgICAgICAgIGRlZmF1bHRDbGllbnREYXRhYmFzZVByZWZpeCA9IGBkYXRhXyR7Y2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2F1dGhlbnRpY2F0aW9uVHlwZX1gO1xuICAgICAgICB9XG4gICAgICAgIG1vYmlsZUNvbmZpZy5hdXRoLnBsdWdpbnMuYXdzQ29nbml0b0F1dGhQbHVnaW4uQXBwU3luYyA9IHtcbiAgICAgICAgICBEZWZhdWx0OiB7XG4gICAgICAgICAgICBBcGlVcmw6IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19ncmFwaHFsRW5kcG9pbnQsXG4gICAgICAgICAgICBSZWdpb246IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19yZWdpb24sXG4gICAgICAgICAgICBBdXRoTW9kZTogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2F1dGhlbnRpY2F0aW9uVHlwZSxcbiAgICAgICAgICAgIEFwaUtleTogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2FwaUtleSxcbiAgICAgICAgICAgIENsaWVudERhdGFiYXNlUHJlZml4OiBkZWZhdWx0Q2xpZW50RGF0YWJhc2VQcmVmaXgsXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19hZGRpdGlvbmFsQXV0aGVudGljYXRpb25UeXBlcykge1xuICAgICAgICAgIGZvciAoY29uc3QgYWRkaXRpb25hbEF1dGhlbnRpY2F0aW9uVHlwZSBvZiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYWRkaXRpb25hbEF1dGhlbnRpY2F0aW9uVHlwZXMuc3BsaXQoXG4gICAgICAgICAgICAnLCdcbiAgICAgICAgICApKSB7XG4gICAgICAgICAgICBtb2JpbGVDb25maWcuYXV0aC5wbHVnaW5zLmF3c0NvZ25pdG9BdXRoUGx1Z2luLkFwcFN5bmNbXG4gICAgICAgICAgICAgIGBkYXRhXyR7YWRkaXRpb25hbEF1dGhlbnRpY2F0aW9uVHlwZX1gXG4gICAgICAgICAgICBdID0ge1xuICAgICAgICAgICAgICBBcGlVcmw6IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19ncmFwaHFsRW5kcG9pbnQsXG4gICAgICAgICAgICAgIFJlZ2lvbjogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX3JlZ2lvbixcbiAgICAgICAgICAgICAgQXV0aE1vZGU6IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19hdXRoZW50aWNhdGlvblR5cGUsXG4gICAgICAgICAgICAgIEFwaUtleTogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2FwaUtleSxcbiAgICAgICAgICAgICAgQ2xpZW50RGF0YWJhc2VQcmVmaXg6IGBkYXRhXyR7YWRkaXRpb25hbEF1dGhlbnRpY2F0aW9uVHlwZX1gLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2xpZW50Q29uZmlnLmdlbykge1xuICAgICAgY29uc3QgZ2VvQ29uZmlnOiBDbGllbnRDb25maWdNb2JpbGVHZW8gPSB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICBhd3NMb2NhdGlvbkdlb1BsdWdpbjoge1xuICAgICAgICAgICAgcmVnaW9uOiBjbGllbnRDb25maWcuZ2VvLmFtYXpvbl9sb2NhdGlvbl9zZXJ2aWNlLnJlZ2lvbixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbWFwcyA9IGNsaWVudENvbmZpZy5nZW8uYW1hem9uX2xvY2F0aW9uX3NlcnZpY2UubWFwcztcbiAgICAgIGlmIChtYXBzKSB7XG4gICAgICAgIGdlb0NvbmZpZy5wbHVnaW5zLmF3c0xvY2F0aW9uR2VvUGx1Z2luLm1hcHMgPSBtYXBzO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2VhcmNoSW5kaWNlcyA9XG4gICAgICAgIGNsaWVudENvbmZpZy5nZW8uYW1hem9uX2xvY2F0aW9uX3NlcnZpY2Uuc2VhcmNoX2luZGljZXM7XG4gICAgICBpZiAoc2VhcmNoSW5kaWNlcykge1xuICAgICAgICBnZW9Db25maWcucGx1Z2lucy5hd3NMb2NhdGlvbkdlb1BsdWdpbi5zZWFyY2hJbmRpY2VzID0gc2VhcmNoSW5kaWNlcztcbiAgICAgIH1cblxuICAgICAgbW9iaWxlQ29uZmlnLmdlbyA9IGdlb0NvbmZpZztcbiAgICB9XG5cbiAgICBpZiAoY2xpZW50Q29uZmlnLkFuYWx5dGljcykge1xuICAgICAgbW9iaWxlQ29uZmlnLmFuYWx5dGljcyA9IHtcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgIGF3c1BpbnBvaW50QW5hbHl0aWNzUGx1Z2luOiB7XG4gICAgICAgICAgICBwaW5wb2ludEFuYWx5dGljczoge1xuICAgICAgICAgICAgICByZWdpb246IGNsaWVudENvbmZpZy5BbmFseXRpY3MuUGlucG9pbnQucmVnaW9uLFxuICAgICAgICAgICAgICBhcHBJZDogY2xpZW50Q29uZmlnLkFuYWx5dGljcy5QaW5wb2ludC5hcHBJZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwaW5wb2ludFRhcmdldGluZzoge1xuICAgICAgICAgICAgICByZWdpb246IGNsaWVudENvbmZpZy5BbmFseXRpY3MuUGlucG9pbnQucmVnaW9uLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMpIHtcbiAgICAgIG1vYmlsZUNvbmZpZy5ub3RpZmljYXRpb25zID0ge1xuICAgICAgICBwbHVnaW5zOiB7fSxcbiAgICAgIH07XG4gICAgICBpZiAoY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMuU01TKSB7XG4gICAgICAgIG1vYmlsZUNvbmZpZy5ub3RpZmljYXRpb25zLnBsdWdpbnMuYXdzUGlucG9pbnRTbXNOb3RpZmljYXRpb25zUGx1Z2luID1cbiAgICAgICAgICBjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5TTVMuQVdTUGlucG9pbnQ7XG4gICAgICB9XG4gICAgICBpZiAoY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMuRU1BSUwpIHtcbiAgICAgICAgbW9iaWxlQ29uZmlnLm5vdGlmaWNhdGlvbnMucGx1Z2lucy5hd3NQaW5wb2ludEVtYWlsTm90aWZpY2F0aW9uc1BsdWdpbiA9XG4gICAgICAgICAgY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMuRU1BSUwuQVdTUGlucG9pbnQ7XG4gICAgICB9XG4gICAgICBpZiAoY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMuSW5BcHBNZXNzYWdpbmcpIHtcbiAgICAgICAgbW9iaWxlQ29uZmlnLm5vdGlmaWNhdGlvbnMucGx1Z2lucy5hd3NQaW5wb2ludEluQXBwTWVzc2FnaW5nTm90aWZpY2F0aW9uc1BsdWdpbiA9XG4gICAgICAgICAgY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMuSW5BcHBNZXNzYWdpbmcuQVdTUGlucG9pbnQ7XG4gICAgICB9XG4gICAgICBpZiAoY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMuUHVzaCkge1xuICAgICAgICBtb2JpbGVDb25maWcubm90aWZpY2F0aW9ucy5wbHVnaW5zLmF3c1BpbnBvaW50UHVzaE5vdGlmaWNhdGlvbnNQbHVnaW4gPVxuICAgICAgICAgIGNsaWVudENvbmZpZy5Ob3RpZmljYXRpb25zLlB1c2guQVdTUGlucG9pbnQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNsaWVudENvbmZpZy5hd3NfdXNlcl9maWxlc19zM19idWNrZXQpIHtcbiAgICAgIG1vYmlsZUNvbmZpZy5zdG9yYWdlID0ge1xuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgYXdzUzNTdG9yYWdlUGx1Z2luOiB7XG4gICAgICAgICAgICBidWNrZXQ6IGNsaWVudENvbmZpZy5hd3NfdXNlcl9maWxlc19zM19idWNrZXQsXG4gICAgICAgICAgICByZWdpb246IGNsaWVudENvbmZpZy5hd3NfdXNlcl9maWxlc19zM19idWNrZXRfcmVnaW9uLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBtb2JpbGVDb25maWc7XG4gIH07XG59XG4iXX0=